window.onload = function () {

    var countyGA = [
        "-Select County-",
        "Appling County",
        "Atkinson County",
        "Bacon County",
        "Baker County",
        "Baldwin County",
        "Banks County",
        "Barrow County",
        "Bartow County",
        "Ben Hill County",
        "Berrien County",
        "Bibb County",
        "Bleckley County",
        "Brantley County",
        "Brooks County",
        "Bryan County",
        "Bulloch County",
        "Burke County",
        "Butts County",
        "Calhoun County",
        "Camden County",
        "Candler County",
        "Carroll County",
        "Catoosa County",
        "Charlton County",
        "Chatham County",
        "Chattahoochee County",
        "Chattooga County",
        "Cherokee County",
        "Clarke County",
        "Clay County",
        "Clayton County",
        "Clinch County",
        "Cobb County",
        "Coffee County",
        "Colquitt County",
        "Columbia County",
        "Cook County",
        "Coweta County",
        "Crawford County",
        "Crisp County",
        "Dade County",
        "Dawson County",
        "Decatur County",
        "DeKalb County",
        "Dodge County",
        "Dooly County",
        "Dougherty County",
        "Douglas County",
        "Early County",
        "Echols County",
        "Effingham County",
        "Elbert County",
        "Emanuel County",
        "Evans County",
        "Fannin County",
        "Fayette County",
        "Floyd County",
        "Forsyth County",
        "Franklin County",
        "Fulton County",
        "Gilmer County",
        "Glascock County",
        "Glynn County",
        "Gordon County",
        "Grady County",
        "Greene County",
        "Gwinnett County",
        "Habersham County",
        "Hall County",
        "Hancock County",
        "Haralson County",
        "Harris County",
        "Hart County",
        "Heard County",
        "Henry County",
        "Houston County",
        "Irwin County",
        "Jackson County",
        "Jasper County",
        "Jeff Davis County",
        "Jefferson County",
        "Jenkins County",
        "Johnson County",
        "Jones County",
        "Lamar County",
        "Lanier County",
        "Laurens County",
        "Lee County",
        "Liberty County",
        "Lincoln County",
        "Long County",
        "Lowndes County",
        "Lumpkin County",
        "McDuffie County",
        "McIntosh County",
        "Macon County",
        "Madison County",
        "Marion County",
        "Meriwether County",
        "Miller County",
        "Mitchell County",
        "Monroe County",
        "Montgomery County",
        "Morgan County",
        "Murray County",
        "Muscogee County",
        "Newton County",
        "Oconee County",
        "Oglethorpe County",
        "Paulding County",
        "Peach County",
        "Pickens County",
        "Pierce County",
        "Pike County",
        "Polk County",
        "Pulaski County",
        "Putnam County",
        "Quitman County",
        "Rabun County",
        "Randolph County",
        "Richmond County",
        "Rockdale County",
        "Schley County",
        "Screven County",
        "Seminole County",
        "Spalding County",
        "Stephens County",
        "Stewart County",
        "Sumter County",
        "Talbot County",
        "Taliaferro County",
        "Tattnall County",
        "Taylor County",
        "Telfair County",
        "Terrell County",
        "Thomas County",
        "Tift County",
        "Toombs County",
        "Towns County",
        "Treutlen County",
        "Troup County",
        "Turner County",
        "Twiggs County",
        "Union County",
        "Upson County",
        "Walker County",
        "Walton County",
        "Ware County",
        "Warren County",
        "Washington County",
        "Wayne County",
        "Webster County",
        "Wheeler County",
        "White County",
        "Whitfield County",
        "Wilcox County",
        "Wilkes County",
        "Wilkinson County",
        "Worth County"];

    var countyFIPS = [
        null,
        "001",
        "003",
        "005",
        "007",
        "009",
        "011",
        "013",
        "015",
        "017",
        "019",
        "021",
        "023",
        "025",
        "027",
        "029",
        "031",
        "033",
        "035",
        "037",
        "039",
        "043",
        "045",
        "047",
        "049",
        "051",
        "053",
        "055",
        "057",
        "059",
        "061",
        "063",
        "065",
        "067",
        "069",
        "071",
        "073",
        "075",
        "077",
        "079",
        "081",
        "083",
        "085",
        "087",
        "089",
        "091",
        "093",
        "095",
        "097",
        "099",
        "101",
        "103",
        "105",
        "107",
        "109",
        "111",
        "113",
        "115",
        "117",
        "119",
        "121",
        "123",
        "125",
        "127",
        "129",
        "131",
        "133",
        "135",
        "137",
        "139",
        "141",
        "143",
        "145",
        "147",
        "149",
        "151",
        "153",
        "155",
        "157",
        "159",
        "161",
        "163",
        "165",
        "167",
        "169",
        "171",
        "173",
        "175",
        "177",
        "179",
        "181",
        "183",
        "185",
        "187",
        "189",
        "191",
        "193",
        "195",
        "197",
        "199",
        "201",
        "205",
        "207",
        "209",
        "211",
        "213",
        "215",
        "217",
        "219",
        "221",
        "223",
        "225",
        "227",
        "229",
        "231",
        "233",
        "235",
        "237",
        "239",
        "241",
        "243",
        "245",
        "247",
        "249",
        "251",
        "253",
        "255",
        "257",
        "259",
        "261",
        "263",
        "265",
        "267",
        "269",
        "271",
        "273",
        "275",
        "277",
        "279",
        "281",
        "283",
        "285",
        "287",
        "289",
        "291",
        "293",
        "295",
        "297",
        "299",
        "301",
        "303",
        "305",
        "307",
        "309",
        "311",
        "313",
        "315",
        "317",
        "319",
        "321"];

    var countyLats = [
        null,
        31.739712,
        31.3005623,
        31.5633274,
        31.3196219,
        33.0595321,
        34.3519216,
        33.9920094,
        34.2409175,
        31.7407755,
        31.274308,
        32.8088443,
        32.4354034,
        31.1973339,
        30.8336956,
        32.0179692,
        32.3934083,
        33.0637365,
        33.2903551,
        31.521279,
        30.9163582,
        32.4039862,
        33.5822366,
        34.8993926,
        30.7799036,
        31.9747555,
        32.3474454,
        34.4741785,
        34.2443166,
        33.9522337,
        31.6198309,
        33.5522424,
        30.9176531,
        33.93994,
        31.5492446,
        31.1897575,
        33.5505555,
        31.152935,
        33.3528965,
        32.7094463,
        31.9147533,
        34.8524237,
        34.4428421,
        30.8779607,
        33.7706611,
        32.1606555,
        32.1519954,
        31.5350683,
        33.6993166,
        31.3241906,
        30.7085,
        32.3617106,
        34.1150165,
        32.5910995,
        32.1519021,
        34.8638367,
        33.4127172,
        34.2636769,
        34.225143,
        34.3751554,
        33.7900338,
        34.6905413,
        33.2274908,
        31.2127465,
        34.5096669,
        30.8758626,
        33.576836,
        33.9591011,
        34.6351078,
        34.3175876,
        33.2692195,
        33.7951649,
        32.7315494,
        34.3487328,
        33.2909683,
        33.4528811,
        32.4583811,
        31.6043062,
        34.134157,
        33.3149051,
        31.8116153,
        33.0518742,
        32.7945631,
        32.6898312,
        33.0202261,
        33.0744604,
        31.0381973,
        32.3932197,
        31.8184185,
        31.8072445,
        33.7921507,
        31.7495633,
        30.8336801,
        34.5681492,
        32.3662155,
        34.1284855,
        32.3595381,
        33.4824637,
        31.4829776,
        33.0302196,
        31.1629079,
        31.2289404,
        33.0174352,
        32.1721081,
        33.5937317,
        34.7970974,
        32.510197,
        33.5440455,
        33.8341247,
        33.8668062,
        33.9209028,
        32.5713241,
        34.4566206,
        31.3539879,
        33.0907685,
        33.9959611,
        32.2387936,
        33.3210605,
        31.8614871,
        34.8830262,
        31.762651,
        33.361487,
        33.6520811,
        32.263441,
        32.7447512,
        30.933894,
        33.2623888,
        34.5529139,
        32.073225,
        32.0422026,
        32.7046026,
        33.5593144,
        32.0437683,
        32.5546668,
        31.9136387,
        31.7771909,
        30.8646156,
        31.4570027,
        32.1266975,
        34.9026495,
        32.4095857,
        33.034482,
        31.7182318,
        32.6658469,
        34.8337696,
        32.8818366,
        34.7358269,
        33.7826485,
        31.050881,
        33.4191691,
        32.9718477,
        31.5478449,
        32.0465538,
        32.109276,
        34.6436773,
        34.8017261,
        31.9627168,
        33.77904,
        32.8043209,
        31.5517733
    ]

    var countyLongs = [
        null,
        -82.2901025,
        -82.8836144,
        -82.3878591,
        -84.454857,
        -83.2553624,
        -83.4984409,
        -83.7123025,
        -84.8381879,
        -83.1471898,
        -83.2319058,
        -83.6941934,
        -83.3317174,
        -81.9829779,
        -83.5889713,
        -81.4385431,
        -81.7438099,
        -82.0038904,
        -83.9582206,
        -84.6262895,
        -81.636516,
        -82.0714459,
        -85.0805272,
        -85.1373531,
        -82.1396442,
        -81.0917682,
        -84.7880206,
        -85.3452894,
        -84.4750574,
        -83.3671299,
        -84.9925826,
        -84.4129771,
        -82.7026143,
        -84.5741657,
        -82.8449382,
        -83.7697405,
        -82.2513423,
        -83.4295515,
        -84.7621381,
        -83.9791817,
        -83.753338,
        -85.5062006,
        -84.1732841,
        -84.5777442,
        -84.2263431,
        -83.156818,
        -83.807167,
        -84.2144444,
        -84.7659441,
        -84.9067225,
        -82.836132,
        -81.3433367,
        -82.8420572,
        -82.2997628,
        -81.887618,
        -84.3192867,
        -84.4939407,
        -85.2137297,
        -84.1273355,
        -83.2272905,
        -84.4681816,
        -84.4539838,
        -82.6069126,
        -81.4965167,
        -84.8738622,
        -84.2447719,
        -83.1671033,
        -84.0229381,
        -83.5264058,
        -83.8184973,
        -83.0004653,
        -85.2200622,
        -84.912432,
        -82.96329,
        -85.1395936,
        -84.1544404,
        -83.6628559,
        -83.2770374,
        -83.5651332,
        -83.6878919,
        -82.6368248,
        -82.4190497,
        -81.9715244,
        -82.6613536,
        -83.5623393,
        -84.1467206,
        -83.0631635,
        -82.9263171,
        -84.1466814,
        -81.4579687,
        -82.4482992,
        -81.7428697,
        -83.2689668,
        -83.9988275,
        -84.0521624,
        -83.2036369,
        -84.5295606,
        -82.473188,
        -81.3701993,
        -84.6632794,
        -84.7303856,
        -84.1924067,
        -83.9229376,
        -82.5333487,
        -83.4923244,
        -84.7379899,
        -84.874946,
        -83.8551891,
        -83.4377284,
        -83.0740805,
        -84.8669788,
        -83.8319779,
        -84.4902556,
        -82.2104266,
        -84.3866265,
        -85.1868259,
        -83.4818548,
        -83.3717898,
        -85.0093171,
        -83.4047353,
        -84.7523108,
        -82.0749983,
        -84.0263696,
        -84.3227238,
        -81.6175849,
        -84.8675915,
        -84.2860671,
        -83.2902156,
        -84.8349117,
        -84.2042832,
        -84.5300288,
        -82.8752078,
        -82.0592081,
        -84.2514261,
        -82.9310624,
        -84.4394464,
        -83.9197828,
        -83.5259307,
        -82.3320708,
        -83.7321583,
        -82.5708819,
        -85.02836,
        -83.6285665,
        -83.4258792,
        -83.9895727,
        -84.292281,
        -85.3053852,
        -83.7342152,
        -82.4215072,
        -82.6880123,
        -82.7981123,
        -81.9123763,
        -84.5532179,
        -82.7387013,
        -83.7437125,
        -84.968541,
        -83.4382617,
        -82.7479223,
        -83.1755868,
        -83.8499598

    ]

    var yearArray = [
        "-Select Year-",
        2010,
        2011,
        2012,
        2013,
        2014,
        2015,
        2016,
        2017];

//     var chartYears = [
//         2010,
//         2011,
//         2012,
//         2013,
//         2014,
//         2015,
//         2016,
//         2017];

    var selectYear = $(`#year-selector`);
    var selectCounty = $(`#county-selector`);

    for (var i = 0; i < countyGA.length; i++) {
        var opt = countyGA[i];
        var el = $(`<option>`);
        el.text(opt);
        el.attr(`value`, opt);
        selectCounty.append(el);
    };

    for (var i = 0; i < yearArray.length; i++) {
        var opt = yearArray[i];
        var el = $(`<option>`);
        el.text(opt);
        el.attr(`value`, opt);
        selectYear.append(el);
    };

//     var mymap = L.map('mapid').setView([0, 0], 10);

//     L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
//         attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
//         maxZoom: 16,
//         id: 'mapbox.streets',
//         accessToken: 'pk.eyJ1Ijoic3Bpbm96aXN0IiwiYSI6ImNqMTJnNXEwejA2MzgzNHBlb2tsYWN2b2oifQ.YFeJxLzYtIs0ATq7AnUpyw'
//     }).addTo(mymap);

    $(`#submit-button`).on(`click`, function () {

        console.log(`button clicked`);

        var stateNames = [
            "Alabama",
            "Alaska",
            "Arizona",
            "Arkansas",
            "California",
            "Colorado",
            "Connecticut",
            "Delaware",
            "District of Columbia",
            "Florida",
            "Georgia",
            "Hawaii",
            "Idaho",
            "Illinois",
            "Indiana",
            "Iowa",
            "Kansas",
            "Kentucky",
            "Louisiana",
            "Maine",
            "Maryland",
            "Massachusetts",
            "Michigan",
            "Minnesota",
            "Mississippi",
            "Missouri",
            "Montana",
            "Nebraska",
            "Nevada",
            "New Hampshire",
            "New Jersey",
            "New Mexico",
            "New York",
            "North Carolina",
            "North Dakota",
            "Ohio",
            "Oklahoma",
            "Oregon",
            "Pennsylvania",
            "Rhode Island",
            "South Carolina",
            "South Dakota",
            "Tennessee",
            "Texas",
            "Utah",
            "Vermont",
            "Virginia",
            "Washington",
            "West Virginia",
            "Wisconsin",
            "Wyoming",
        ];

        var stateFIPS = [
            "01",
            "02",
            "04",
            "05",
            "06",
            "08",
            "09",
            "10",
            "11",
            "12",
            "13",
            "15",
            "16",
            "17",
            "18",
            "19",
            "20",
            "21",
            "22",
            "23",
            "24",
            "25",
            "26",
            "27",
            "28",
            "29",
            "30",
            "31",
            "32",
            "33",
            "34",
            "35",
            "36",
            "37",
            "38",
            "39",
            "40",
            "41",
            "42",
            "44",
            "45",
            "46",
            "47",
            "48",
            "49",
            "50",
            "51",
            "53",
            "54",
            "55",
            "56",
        ];

        var input = $(`#county-selector option:selected`).val();

        var year = $(`#year-selector option:selected`).val();

        var countyID = countyFIPS[countyGA.indexOf(input)]

        // var inputID = stateFIPS[stateNames.indexOf(input)];

        var mapLat = countyLats[countyGA.indexOf(input)];
        var mapLong = countyLongs[countyGA.indexOf(input)];

        var topDataLabel = [
            "Population",
            "Median Household Income",
            "Unemployment Rate",
        ];

        function writePop(response) {
            var population = numeral(response[1][1]).format('0,0');
            $("#year").html(`<p>${year}</p>`);
            $("#geo-name").html(`<h1>${response[1][0]}</h1>`);
            $("#population").html(`<p>${topDataLabel[0]}</p><h2>${population}<h2>`);

            console.log(response);
        };


        function writeInc(response) {
            var income = numeral(response[1][1]).format('$0,0');
            $("#income").html(`<p>${topDataLabel[1]}</p><h2>${income}<h2>`);
            console.log(response);
        };

        function writeUnEmp(response) {
            var unemp = numeral((response[1][1]) / 100).format('0.0%');
            $("#unemployment").html(`<p>${topDataLabel[2]}</p><h2>${unemp}<h2>`);

            console.log(response);
        };
        
        
        var apiKey = `106872a18b40c2368c03c0b84de5322f9e09b710`

        var queryURL = `https://api.census.gov/data/${year}/acs/acs1?key=${apiKey}&get=NAME,B01001_001E&for=county:${countyID}&in=state:13`;

        var queryURL2 = `https://api.census.gov/data/${year}/acs/acs1?key=${apiKey}&get=NAME,B19013_001E&for=county:${countyID}&in=state:13`;

        var queryURL3 = `https://api.census.gov/data/${year}/acs/acs1/subject?key=${apiKey}&get=NAME,S2301_C04_001E&for=county:${countyID}&in=state:13`;


        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(writePop);

        $.ajax({
            url: queryURL2,
            method: "GET"
        }).then(writeInc);

        $.ajax({
            url: queryURL3,
            method: "GET"
        }).then(writeUnEmp);

        // LEAFLET

        $(`#map-container`).empty();
        $(`#map-container`).html(`
        <div id="mapid"></div>
        `);

//         var mymap = L.map('mapid').setView([mapLat, mapLong], 10);

//         L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
//             attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
//             maxZoom: 16,
//             id: 'mapbox.streets',
//             style: 'mapbox://styles/spinozist/cjnc5g98p00ep2rqiyb9i35zp',
//             accessToken: 'pk.eyJ1Ijoic3Bpbm96aXN0IiwiYSI6ImNqMTJnNXEwejA2MzgzNHBlb2tsYWN2b2oifQ.YFeJxLzYtIs0ATq7AnUpyw'
//         }).addTo(mymap);
        
        mapboxgl.accessToken = 'pk.eyJ1Ijoic3Bpbm96aXN0IiwiYSI6ImNqMTJnNXEwejA2MzgzNHBlb2tsYWN2b2oifQ.YFeJxLzYtIs0ATq7AnUpyw';
        const map = new mapboxgl.Map({
        container: 'mapid',
        style: 'mapbox://styles/spinozist/cjnm5gxhw0rc82srsaf9fdwig',
        center: [mapLat, mapLong],
        zoom: 10.0
        });
        
        
        // Chart JS

        // var popArray = [];

        // for (i = 0; i < chartYears.length; i++) {
        //     var chartYear = chartYears[i]
        //     $.ajax({
        //         url: `https://api.census.gov/data/${chartYear}/acs/acs1?get=NAME,B01001_001E&for=county:${countyID}&in=state:13`,
        //         method: "GET"
        //     }).done(function (response) {
        //         var pop = response[1][1];
        //         console.log(`${chartYear}: ${pop}`);
        //         popArray.splice(chartYears.indexOf(chartYear), 0, pop);
        //     });
        // };

        // setTimeout (function(){
        //     var ctx = document.getElementById('myChart').getContext('2d');

        //     var chart = new Chart(ctx, {
        //         // The type of chart we want to create
        //         type: 'line',
    
        //         // The data for our dataset
        //         data: {
        //             labels: chartYears,
        //             datasets: [{
        //                 label: "My First dataset",
        //                 backgroundColor: 'rgb(255, 99, 132)',
        //                 borderColor: 'rgb(255, 99, 132)',
        //                 data: popArray,
        //             }]
        //         },
    
        //         // Configuration options go here
        //         options: {}
        //     });
        // }, 3000);

    });
}
